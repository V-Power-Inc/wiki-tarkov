name: Deploy on Prod

# Настройка автодеплоя

on:
  pull_request:
    branches:
      - "master"
    types:
      - closed

jobs:
  Deploy:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
    - name: Deploy on Prod
      shell: bash
      env:
        SSH_PRIVATE_KEY: ${{secrets.SSH_PRIVATE_KEY}}
        SSH_KNOWN_HOSTS: ${{secrets.SSH_KNOWN_HOSTS}}
        SSH_USER: ${{secrets.SSH_USER}}
      run: |
        mkdir -p ~/.ssh
        cat "$SSH_KNOWN_HOSTS" >> ~/.ssh/known_hosts
        (umask  077 ; echo "$SSH_PRIVATE_KEY" | base64 --decode > ~/.ssh/id_rsa)
        ssh -i ~/.ssh/id_rsa "$SSH_USER"@wiki-tarkov.ru 'cd /var/www/wiki-tarkov/html && git pull origin-github master'

